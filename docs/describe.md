# Техническое описание решения задачи моделирования

## 1. Физическая модель процесса

Задача заключается в моделировании динамики разделения двух тел на орбите: космического аппарата (КА) и последней ступени ракеты-носителя (РН). Процесс можно разделить на два основных этапа.

### Этап 1: Начальное состояние (t = 0)

В момент времени `t=0` КА и ступень РН представляют собой единую конструкцию, движущуюся как единое целое по низкой околоземной орбите. Их центр масс следует по траектории, которая описывается законами Кеплера для центрального гравитационного поля Земли. Между КА и ступенью РН находится пружинный толкатель, сжатый до своей начальной длины. В этот момент подается команда на разделение.

### Этап 2: Активная фаза разделения (0 < t < t_final)

С момента `t=0` пружина начинает разжиматься, создавая силу упругости, которая действует на КА и ступень РН. 

*   **Силы**: В этой фазе на каждое из тел действуют две силы:
    1.  **Гравитационная сила Земли**: Притягивает тела к центру Земли.
    2.  **Сила упругости пружины**: Внутренняя сила для системы "КА + РН", расталкивающая тела. Согласно третьему закону Ньютона, сила, действующая на КА, равна по модулю и противоположна по направлению силе, действующей на РН.
*   **Движение**: Под действием силы пружины тела начинают удаляться друг от друга. Их общий центр масс продолжает двигаться по практически той же самой гравитационной траектории. Фаза заканчивается, когда длина пружины достигает своего конечного значения, ограниченного механическим упором. В этот момент сила пружины резко обнуляется.

### Этап 3: Фаза свободного полета (t > t_final)

Как только пружинный толкатель достигает упора, его действие прекращается. С этого момента КА и ступень РН становятся двумя независимыми объектами, на которые действует только гравитационная сила Земли.

## 2. Математическая модель

Для описания движения используется система обыкновенных дифференциальных уравнений (ОДУ) в инерциальной системе координат ECI J2000.

### 2.1. Уравнения движения

Система уравнений движения, согласно второму закону Ньютона:


 $$ m_{sc} \frac{d^2\vec{r}_{sc}}{dt^2} = \vec{F}_{g, sc} + \vec{F}_{spring} $$
$$ m_{lv} \frac{d^2\vec{r}_{lv}}{dt^2} = \vec{F}_{g, lv} - \vec{F}_{spring} $$


*   **Гравитационная сила**: `\vec{F}_{g} = - \frac{\mu \cdot m_{body}}{|\vec{r}|^3} \vec{r}`
*   **Сила пружины** (закон Гука): `\vec{F}_{spring} = k \cdot (L_0 - d) \cdot \frac{\vec{r}_{rel}}{d}`, где `k` — жёсткость, `L_0` — длина в недеформированном состоянии, `d` — текущая длина. Сила обнуляется, если `d >= L_0` или если `d` достигает механического упора (`L_{final}`).

### 2.2. Начальные условия (t=0)

1.  **Вектор состояния центра масс** (`\vec{r}_{cm,0}`, `\vec{v}_{cm,0}`) вычисляется путем преобразования заданных кеплеровых элементов орбиты в декартовы координаты ECI.
2.  **Начальные векторы состояния тел** вычисляются относительно центра масс. Предполагается, что в начальный момент пружина сжата до длины `L_{initial}` и ориентирована вдоль вектора скорости центра масс.

### 2.3. Система ОДУ для численного интегрирования

Для численного решателя система приводится к системе из 12 скалярных уравнений первого порядка. Вектор состояния `Y = [\vec{r}_{sc}, \vec{v}_{sc}, \vec{r}_{lv}, \vec{v}_{lv}]`. Его производная:
```latex
\frac{dY}{dt} =
\begin{bmatrix}
 \vec{v}_{sc} \\
 \frac{1}{m_{sc}}(\vec{F}_{g, sc} + \vec{F}_{spring}) \\
 \vec{v}_{lv} \\
 \frac{1}{m_{lv}}(\vec{F}_{g, lv} - \vec{F}_{spring})
\end{bmatrix}
```
Эта система решается численно.

## 3. Обоснование численных методов

*   **Интегратор ОДУ**: Для решения системы используется функция `scipy.integrate.solve_ivp`. Метод по умолчанию `RK45` (метод Рунге-Кутты 4(5) порядка с адаптивным шагом) является отличным выбором для орбитальной динамики, так как он обеспечивает хороший баланс между точностью и скоростью вычислений, а также автоматически подбирает шаг интегрирования, что важно для корректной обработки момента прекращения действия силы пружины.

*   **Решение уравнения Кеплера**: Для нахождения эксцентрической аномалии из средней используется функция `scipy.optimize.newton`. Это стандартный и эффективный численный метод для нахождения корней трансцендентных уравнений, каким и является уравнение Кеплера.

## 4. Структура программной реализации

Проект имеет следующую структуру, нацеленную на разделение ответственности и следование функциональному стилю:

*   `src/data_models.py`: Определяет строго типизированные структуры данных (`dataclasses`) для всех входных и выходных параметров. 
*   `src/orbital_mechanics.py`: Содержит чистые функции для астродинамических расчетов. Эти функции не зависят от состояния симуляции и могут быть протестированы и использованы независимо.
*   `src/simulation.py`: Содержит логику, непосредственно связанную с моделированием: функцию правой части ОДУ и функцию, запускающую симуляцию.
*   `src/main.py`: Является точкой входа в приложение. Он отвечает за оркестрацию: определение входных данных, вызов симулятора, измерение времени выполнения, обработку результатов, их сохранение и построение графиков, включая 3D-траектории.
*   `tests/`: Директория содержит модульные тесты для каждого компонента системы, что обеспечивает корректность и надежность кода.

## 5. Результаты и визуализация

После успешного выполнения симуляции, `main.py` генерирует следующие выходные данные в папке `results/`:

*   `simulation_results.csv`: CSV-файл, содержащий подробные результаты симуляции по временным шагам (положение, скорость КА и РН, относительные параметры, сила пружины).
*   `simulation_plots_relative.png`: Графики относительного расстояния, относительной скорости и силы пружины в зависимости от времени.
*   `simulation_plots_position.png`: Графики абсолютных координат положения (X, Y, Z) КА и РН в зависимости от времени.
*   `simulation_plots_velocity.png`: Графики абсолютных координат скорости (Vx, Vy, Vz) КА и РН в зависимости от времени.
*   `simulation_plot_3d_trajectory.png`: 3D-график траекторий КА и РН в инерциальной системе координат ECI, с обозначением начальных и конечных точек.

